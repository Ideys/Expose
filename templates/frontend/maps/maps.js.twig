{% import _self as mapWidget %}

{% if site.mapsKey %}
    <script type="text/javascript">
        function initialize() {

            {# Define map options #}
            var mapOptions = {
                center: new google.maps.LatLng({{ section.latitude }}, {{ section.longitude }}),
                zoom: {{ section.zoom }},
                mapTypeId: google.maps.MapTypeId.{{ section.map_mode }}
            };

            {# Generate the map #}
            var map = new google.maps.Map(document.getElementById("map-{{ section.id }}"), mapOptions);

            {# Add single markers to the map #}
            {% for place in section.items('place')
                if place.hasCoordinates %}
                {{ mapWidget.marker_position(place) }}
            {% endfor %}

            {# Add linked items markers to the map #}
            {% for linked_item in section.linkedSectionsItems
                if linked_item.hasCoordinates %}

                {{ mapWidget.marker_position(place) }}

                var contentPanel = new google.maps.InfoWindow({
                    content: '{{ place.parent_id }}'
                });
                google.maps.event.addListener(marker, 'click', function() {
                    contentPanel.open(map, marker);
                });

            {% endfor %}
        }

        initialize();
    </script>
{% endif %}

{% macro marker_position(place) %}
    var marker = new google.maps.Marker({
    position: new google.maps.LatLng({{ place.latitude }},{{ place.longitude }}),
    map: map,
    title: '{{ place.title }}'
    });
{% endmacro %}
