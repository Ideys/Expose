{% extends "backend/layout.html.twig" %}

{% block main -%}
<div class="row">
  <div class="large-12 columns">
    <dl class="accordion" data-accordion><dd>
    <a href="#new-section">{{ 'section.new'|trans }}</a>
    <div id="new-section" class="content">
    {{ form_start(form, {'action': path('admin_content_manager')}) }}
      {{ form_errors(form) }}
      <div class="row">
        <div class="medium-8 columns">
          {{ form_widget(form.title) }}
        </div>
        <div class="medium-4 columns">
          {{ form_widget(form.type) }}
        </div>
      </div>
      <div class="row">
        <div class="medium-12 columns">
          {{ form_widget(form.description) }}
        </div>
      </div>
      <div class="row">
        <div class="medium-8 columns">
          {{ form_widget(form.dir) }}
        </div>
        <div class="medium-4 columns">
          {{ form_widget(form.active) }}
          {{ form_label(form.active) }}
        </div>
      </div>
      <div class="hidden">
        {{ form_rest(form) }}
      </div>
      <div class="text-right">
        <input type="submit" name="submit"
               value="{{ 'submit'|trans }}" class="tiny button">
      </div>
    {{ form_end(form) }}
    </div>
  </dd></dl>
  </div>
</div>
<hr>
<div class="row">
  <div class="large-12 columns">
    {% for section in sections %}
      {% if 'dir' == section.type %}
        <h3>{{ section.title }}</h3>
        <dl class="accordion" data-accordion>
          {% for section in section.sections %}
            {% include "backend/_section"~section.type|capitalize~".html.twig"
                  with {'section': section, 'items': items} only %}
          {% endfor %}
        </dl>
        <hr>
      {% else %}
        <dl class="accordion" data-accordion>
          {% include "backend/"~section.type~"Manager/_section"~section.type|capitalize~".html.twig"
                with {'section': section, 'items': items} only %}
        </dl>
        <hr>
      {% endif %}
    {% endfor %}
  </div>
</div>
<form id="fileupload"
      class="hidden"
      action="{{ path('admin_gallery_manager_upload') }}"
      method="POST"
      enctype="multipart/form-data">
    <input type="file" name="files[]" multiple>
    <input type="hidden" name="sectionId" value="0">
    <button type="submit"></button>
</form>
{%- endblock main %}

{% block javascripts %}
{{ parent() }}
<script src="{{ app.request.basepath }}/js/vendor/jquery.ui.widget.js"></script>
<script src="{{ app.request.basepath }}/js/vendor/jquery.iframe-transport.js"></script>
<script src="{{ app.request.basepath }}/js/vendor/jquery.fileupload.js"></script>
<script>
$(function () {
    $('.content.gallery').each(function(){
        $(this).on('click', '[data-item-upload]', function(){
            var sectionId = $(this).data('item-upload');
            console.log(sectionId)
            $('#fileupload [name="sectionId"]').val(sectionId);
        });
    });
    $('#fileupload').fileupload({
        dataType: 'json',
        done: function (e, data) {
            console.log(data._response.result);
        }
    });
});
</script>
{% endblock javascripts %}